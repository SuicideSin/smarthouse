<html>
	<head>
		<title>Smarthouse Control</title>


		<div>
			<center><img src="http://facilities.alaska.edu/ua/eworf/images/UAF_LOGO.gif"><br>
			CyberAK Smarthouse Control

		</div>
		<hr>
		<script language="javascript" type="text/javascript" src="jscolor/jscolor.js"></script>
		<script language="javascript" type="text/javascript" src="jquery.min.js"></script>
		<script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
		<link href="examples.css" rel="stylesheet" type="text/css">
		<script type="text/javascript">

			var flot_temps=[];
			var flot_data_size=300;
			var flot_plot;
			var flot_update_interval=500;
			var flot_width=640;
			var flot_height=480;
			var flot_x_show=true;
			var flot_x_min=0;
			var flot_x_max=flot_data_size;
			var flot_y_show=true;
			var flot_y_min=55;
			var flot_y_max=100;

			function initialize()
			{
				flot_setup();
				setInterval(flot_update,flot_update_interval);
			}

			function flot_pack_xy(data)
			{
				var res=[];

				for(var ii=0;ii<data.length;++ii)
					res.push([ii,data[ii]]);

				return res;
			}

			function flot_setup()
			{
				var flot_graph_array=[];

				for(var ii=0;ii<4;++ii)
				{
					flot_temps[ii]=[];

					for(var jj=0;jj<flot_data_size;++jj)
						flot_temps[ii][jj]=0;

					flot_graph_array[ii]=flot_pack_xy(flot_temps[ii]);
				}

				document.getElementById("flot_plot").style.width=flot_width+"px";
				document.getElementById("flot_plot").style.height=flot_height+"px";

				flot_plot=$.plot("#flot_plot",flot_graph_array,
				{
					series:{shadowSize:0},
					xaxis:{show:flot_x_show,min:flot_x_min,max:flot_x_max},
					yaxis:{show:flot_y_show,min:flot_y_min,max:flot_y_max}
				});
			}

			function flot_update()
			{
				var xmlhttp=new XMLHttpRequest();

				xmlhttp.onreadystatechange=function()
				{
					if(xmlhttp.readyState==4&&xmlhttp.status==200)
					{
						try
						{
							var return_json=JSON.parse(xmlhttp.responseText);

							if(return_json)
							{
								var flot_graph_array=[];

								for(var ii=0;ii<4;++ii)
								{
									flot_temps[ii]=flot_temps[ii].slice(1);
									flot_temps[ii][flot_temps[ii].length]=((parseInt(return_json[ii])*5/1023)*100-50)*9/5+32;
									flot_graph_array[ii]=flot_pack_xy(flot_temps[ii]);
								}

								flot_plot.setData(flot_graph_array);
								flot_plot.draw();
							}
						}
						catch(e)
						{}
					}
				}

				xmlhttp.open("GET",encodeURIComponent("temperatures?"),true);
				xmlhttp.send(null);
			}

			function updateColor1(color)
			{
				var xmlhttp = new XMLHttpRequest();
				var red=Math.round(color.rgb[0]*255);
				var green=Math.round(color.rgb[1]*255);
				var blue=Math.round(color.rgb[2]*255);

				xmlhttp.open("GET", encodeURIComponent("color1?"+red.toString()+'?'+green.toString()+'?'+blue.toString()+'?'),true);
				xmlhttp.send(null);
			}
			function updateColor2(color)
			{
				var xmlhttp = new XMLHttpRequest();
				var red=Math.round(color.rgb[0]*255);
				var green=Math.round(color.rgb[1]*255);
				var blue=Math.round(color.rgb[2]*255);

				xmlhttp.open("GET", encodeURIComponent("color2?"+red.toString()+'?'+green.toString()+'?'+blue.toString()+'?'),true);
				xmlhttp.send(null);
			}
			function updateColor3(color)
			{
				var xmlhttp = new XMLHttpRequest();
				var red=Math.round(color.rgb[0]*255);
				var green=Math.round(color.rgb[1]*255);
				var blue=Math.round(color.rgb[2]*255);

				xmlhttp.open("GET", encodeURIComponent("color3?"+red.toString()+'?'+green.toString()+'?'+blue.toString()+'?'),true);
				xmlhttp.send(null);
			}
			function updateColor4(color)
			{
				var xmlhttp = new XMLHttpRequest();
				var red=Math.round(color.rgb[0]*255);
				var green=Math.round(color.rgb[1]*255);
				var blue=Math.round(color.rgb[2]*255);

				xmlhttp.open("GET", encodeURIComponent("color4?"+red.toString()+'?'+green.toString()+'?'+blue.toString()+'?'),true);
				xmlhttp.send(null);
			}
		</script>
		</head>
	<body onload="initialize();">
		Room 1:<input class="color" onchange="updateColor1(this.color);" readonly><br>
		Room 2:<input class="color" onchange="updateColor2(this.color);" readonly><br>
		Room 3:<input class="color" onchange="updateColor3(this.color);" readonly><br>
		Room 4:<input class="color" onchange="updateColor4(this.color);" readonly><br>
		Temp:<input id="temp" readonly><br>
		<div id="flot_plot"></div>
	</body>
</html>
